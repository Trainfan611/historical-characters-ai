# üîß –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å Telegram Webhook (–®–∞–≥ 2)

## –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ PowerShell —Å–∫—Ä–∏–ø—Ç (Windows) ‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ PowerShell

1. –ù–∞–∂–º–∏—Ç–µ `Win + X`
2. –í—ã–±–µ—Ä–∏—Ç–µ "Windows PowerShell" –∏–ª–∏ "–¢–µ—Ä–º–∏–Ω–∞–ª"

### –®–∞–≥ 2: –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞

```powershell
cd C:\Users\Dell\historical-characters-ai
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

```powershell
.\scripts\update-webhook.ps1
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ù–∞–π–¥–µ—Ç —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û–±–Ω–æ–≤–∏—Ç webhook –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
- –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω**, —Å–∫—Ä–∏–ø—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –µ–≥–æ –≤—Ä—É—á–Ω—É—é.

---

## –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ curl –≤ PowerShell (–≤—Ä—É—á–Ω—É—é)

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

–¢–æ–∫–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Railway –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `TELEGRAM_BOT_TOKEN_BASE` –∏–ª–∏ `TELEGRAM_BOT_TOKEN`.

–ò–ª–∏ –ø–æ–ª—É—á–∏—Ç–µ –µ–≥–æ –æ—Ç @BotFather –≤ Telegram:
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/mybots`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –í—ã–±–µ—Ä–∏—Ç–µ "API Token"
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ webhook

–ó–∞–º–µ–Ω–∏—Ç–µ `–í–ê–®_–¢–û–ö–ï–ù` –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω:

```powershell
$token = "–í–ê–®_–¢–û–ö–ï–ù"
$webhookUrl = "https://historical-characters.up.railway.app/api/telegram/webhook"

Invoke-RestMethod -Uri "https://api.telegram.org/bot$token/setWebhook" -Method Post -Body @{
    url = $webhookUrl
} -ContentType "application/x-www-form-urlencoded"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook

```powershell
Invoke-RestMethod -Uri "https://api.telegram.org/bot$token/getWebhookInfo" -Method Get
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```json
{
  "ok": true,
  "result": {
    "url": "https://historical-characters.up.railway.app/api/telegram/webhook",
    "pending_update_count": 0
  }
}
```

---

## –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

–°–º. "–°–ø–æ—Å–æ–± 2, –®–∞–≥ 1" –≤—ã—à–µ.

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–ó–∞–º–µ–Ω–∏—Ç–µ `–í–ê–®_–¢–û–ö–ï–ù` –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω:

```
https://api.telegram.org/bot–í–ê–®_–¢–û–ö–ï–ù/setWebhook?url=https://historical-characters.up.railway.app/api/telegram/webhook
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```json
{
  "ok": true,
  "result": true,
  "description": "Webhook was set"
}
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `–í–ê–®_–¢–û–ö–ï–ù`):

```
https://api.telegram.org/bot–í–ê–®_–¢–û–ö–ï–ù/getWebhookInfo
```

---

## –°–ø–æ—Å–æ–± 4: –ß–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å—ã

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Postman –∏–ª–∏ Insomnia

1. –°–æ–∑–¥–∞–π—Ç–µ POST –∑–∞–ø—Ä–æ—Å:
   - URL: `https://api.telegram.org/bot–í–ê–®_–¢–û–ö–ï–ù/setWebhook`
   - Method: POST
   - Body (form-data):
     - `url`: `https://historical-characters.up.railway.app/api/telegram/webhook`

2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è webhook:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:**
   ```
   https://historical-characters.up.railway.app/api/telegram/debug
   ```
   
   –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   - `status: "ok"`
   - `webhook.url` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
   - `pendingUpdateCount: 0`

2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É `/start`**
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π (–µ—Å–ª–∏ –≤—ã –∞–¥–º–∏–Ω)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway**
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ 404

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Unauthorized" –∏–ª–∏ "Invalid token"

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Ü–∏—Ñ—Ä –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–≤–æ–µ—Ç–æ—á–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

### –ü—Ä–æ–±–ª–µ–º–∞: "Bad Request"

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `https://`

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –æ–±–Ω–æ–≤–∏–ª—Å—è, –Ω–æ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã (Telegram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `NEXTAUTH_URL` –≤ Railway —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

**–£–¥–∞—á–∏! üöÄ**
